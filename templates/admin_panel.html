<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>لوحة الأداري - الإشعارات العامة</title>
<link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
<div class="container">
<h2>لوحة الأداري - إضافة إشعار جديد</h2>
<form id="addForm" enctype="multipart/form-data">
<input type="hidden" name="number" value="1430">
<label>عنوان الإشعار *</label><br>
<input name="title" required><br>
<label>نص الإشعار *</label><br>
<textarea name="body" required></textarea><br>
<label>الفئة / القسم</label><br>
<input name="category"><br>
<label>صورة (اختياري)</label><br>
<input type="file" name="image" accept="image/*"><br>
<label>رابط (اختياري)</label><br>
<input name="link" placeholder="https://"><br><br>
<button type="submit">إرسال</button>
</form>

<h3>قائمة الأخبار</h3>
<div id="newsList"></div>
</div>

<script>
async function loadNews(){
  const res = await fetch('/api/notifications');
  const data = await res.json();
  const container = document.getElementById('newsList');
  container.innerHTML='';
  data.forEach(n=>{
    const el = document.createElement('div');
    el.innerHTML=`<h4>${n.title}</h4>
      <p>${n.body}</p>
      ${n.category?`<b>فئة:</b> ${n.category}<br>`:''}
      ${n.image?`<img src="/static/uploads/${n.image}" style="max-width:120px"><br>`:''}
      ${n.link?`<a href="${n.link}" target="_blank">رابط الإشعار</a><br>`:''}
      <button onclick="del(${n.id})">حذف</button>`;
    container.appendChild(el);
  });
}

async function del(id){
  await fetch('/api/admin/delete/'+id,{method:'POST'});
  loadNews();
}

document.getElementById('addForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const form = e.target;
  const fd = new FormData(form);
  const res = await fetch('/api/admin/add',{method:'POST',body:fd});
  const j = await res.json();
  if(j.ok){alert('تم الإضافة'); form.reset(); loadNews();}
});

loadNews();
</script>
</body>
</html>